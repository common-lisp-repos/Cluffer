\section{Our technique}

\subsection{Protocols}

We suggest a \clos{}-based \emph{protocol} defining the set of
operations on a buffer.  In fact, the protocol can be divided into
three fairly-independent protocols:

\begin{itemize}
\item An external protocol for interacting with the contents of a
  single line.  This protocol contains functions for inserting and
  deleting items in a line, for obtaining items and item count in a
  line, and also for manipulating the \emph{cursor} abstraction.
\item An external protocol for interacting with the contents of the
  buffer as a whole.  This protocol contains functions for inserting
  and deleting lines in the buffer, and for querying the line count
  and item count of the entire buffer.
\item An internal protocol that manages the interaction between the
  line abstraction and the buffer abstraction.
\end{itemize}

\subsection{Supplied implementations}

For the \emph{line protocol}, we supply two different implementations,
the \emph{standard line} implementation and the \emph{simple line}
implementation.  Similarly, for the \emph{buffer protocol}, we supply
two different implementations, the \emph{standard buffer} implementation
and the \emph{simple buffer} implementation.

\subsubsection{Standard line implementation}

The standard line implementation is the one that a typical application
would always use, unless an application-specific line implementation
is desired.

This implementation supplies two different representations of the line
that we call \emph{open} and \emph{closed} respectively.  An line is
\emph{open} if the last operation on it was an editing operation.  It
is \emph{closed} if the last operation was a contents query in the
form of a call to the generic function \texttt{items}.  Accordingly, a
line is changed from being open to being closed whenever there is a
contents query, and from closed to open when there is call to an
editing operation.

A closed line is represented as a \commonlisp{} simple vector.  An
open line is represented as a gap buffer. \seesec{sec-previous-work}
